(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{532:function(a,e,l){"use strict";l.r(e);var t=l(27),s=Object(t.a)({},(function(){var a=this,e=a.$createElement,l=a._self._c||e;return l("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[l("h1",{attrs:{id:"canal部署"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#canal部署"}},[a._v("#")]),a._v(" canal部署")]),a._v(" "),l("p",[a._v("canal官方仓库:"),l("code",[a._v("https://github.com/alibaba/canal/")])]),a._v(" "),l("p",[a._v("wiki:"),l("code",[a._v("https://github.com/alibaba/canal/wiki")])]),a._v(" "),l("p",[a._v("canal的用途是基于mysql的binlog日志解析，提供增量数据的订阅和消费。简单的场景：通过canal监控mysql数据变更从而及时更新redis中对应的缓存。")]),a._v(" "),l("p",[a._v("本文主要介绍canal在服务器端的部署，包括"),l("code",[a._v("canal-admin")]),a._v(","),l("code",[a._v("canal-tsdb配置")]),a._v("以及"),l("code",[a._v("instance")]),a._v("配置。")]),a._v(" "),l("p",[a._v("首先需要下载canal的发行版，下载地址：https://github.com/alibaba/canal/releases，可自行选择版本，这里直接选择最新的v1.1.5。系统版本为centos7。")]),a._v(" "),l("h2",{attrs:{id:"canal-admin"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#canal-admin"}},[a._v("#")]),a._v(" canal admin")]),a._v(" "),l("ul",[l("li",[a._v("解压")])]),a._v(" "),l("div",{staticClass:"language-bash line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-bash"}},[l("code",[l("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" zxvf canal.admin-1.1.5.tar.gz -C /home/install/canal/admin\n")])]),a._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[a._v("1")]),l("br")])]),l("ul",[l("li",[l("p",[a._v("执行conf文件夹中的canal_manager.sql建表")]),a._v(" "),l("p",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617000438523.png",alt:"image-20210617000438523"}})]),a._v(" "),l("p",[a._v("修改conf文件夹中的application.yml")]),a._v(" "),l("p",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617001123953.png",alt:"image-20210617001123953"}})]),a._v(" "),l("ul",[l("li",[l("p",[a._v("开放admin控制台的端口，以默认的8089为例")]),a._v(" "),l("p",[a._v("开放端口："),l("code",[a._v("firewall-cmd --zone=public --add-port=8089/tcp --permanent")])]),a._v(" "),l("p",[a._v("配置立即生效："),l("code",[a._v("firewall-cmd --reload")])])])])]),a._v(" "),l("li",[l("p",[a._v("执行bin目录的startup.sh")])]),a._v(" "),l("li",[l("p",[a._v("访问8089端口")]),a._v(" "),l("p",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617001200010.png",alt:"image-20210617001200010"}})])]),a._v(" "),l("li",[l("p",[a._v("使用默认账号密码 admin/123456即可登录")])]),a._v(" "),l("li",[l("p",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617001457272.png",alt:"image-20210617001457272"}})])])]),a._v(" "),l("blockquote",[l("blockquote",[l("p",[a._v("canal-admin的核心模型主要有：")])]),a._v(" "),l("ol",[l("li",[a._v("instance，对应canal-server里的instance，一个最小的订阅mysql的队列")]),a._v(" "),l("li",[a._v("server，对应canal-server，一个server里可以包含多个instance")]),a._v(" "),l("li",[a._v("集群，对应一组canal-server，组合在一起面向高可用HA的运维")])]),a._v(" "),l("p",[a._v("简单解释：")]),a._v(" "),l("ol",[l("li",[a._v("instance因为是最原始的业务订阅诉求，它会和 server/集群 这两个面向资源服务属性的进行关联，比如instance A绑定到server A上或者集群 A上，")]),a._v(" "),l("li",[a._v("有了任务和资源的绑定关系后，对应的资源服务就会接收到这个任务配置，在对应的资源上动态加载instance，并提供服务\n"),l("ul",[l("li",[a._v("动态加载的过程，对应配置文件中的autoScan配置，只不过基于canal-admin之后可就以变为远程的web操作，而不需要在机器上运维配置文件")])])]),a._v(" "),l("li",[a._v("将server抽象成资源之后，原本canal-server运行所需要的canal.properties/instance.properties配置文件就需要在web ui上进行统一运维，每个server只需要以最基本的启动配置 (比如知道一下canal-admin的manager地址，以及访问配置的账号、密码即可)")])])]),a._v(" "),l("ul",[l("li",[l("p",[a._v("新建server，按照图中配置即可")]),a._v(" "),l("p",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617001928077.png",alt:"image-20210617001928077"}})]),a._v(" "),l("blockquote",[l("p",[a._v("配置项：")]),a._v(" "),l("ul",[l("li",[a._v("所属集群，可以选择为单机 或者 集群。一般单机Server的模式主要用于一次性的任务或者测试任务")]),a._v(" "),l("li",[a._v("Server名称，唯一即可，方便自己记忆")]),a._v(" "),l("li",[a._v("Server Ip，机器ip")]),a._v(" "),l("li",[a._v("admin端口，canal 1.1.4版本新增的能力，会在canal-server上提供远程管理操作，默认值11110")]),a._v(" "),l("li",[a._v("tcp端口，canal提供netty数据订阅服务的端口")]),a._v(" "),l("li",[a._v("metric端口， promethues的exporter监控数据端口 (未来会对接监控)")])])])])]),a._v(" "),l("h2",{attrs:{id:"canal-deployer"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#canal-deployer"}},[a._v("#")]),a._v(" canal deployer")]),a._v(" "),l("ul",[l("li",[a._v("解压")])]),a._v(" "),l("div",{staticClass:"language-bash line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-bash"}},[l("code",[l("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xzvf canal.deployer-1.1.5.tar.gz -C /home/install/canal/deployer\n")])]),a._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[a._v("1")]),l("br")])]),l("ul",[l("li",[l("p",[a._v("用conf目录下的canal_local.properties替换canal.properties")])]),a._v(" "),l("li",[l("p",[a._v("执行bin目录下的startup.sh")])]),a._v(" "),l("li",[l("p",[a._v("直接在canal admin的webUI界面中配置instance即可")]),a._v(" "),l("ul",[l("li",[l("img",{attrs:{src:"https://storyxc.com/images/blog//image-20210617002844737.png",alt:"image-20210617002844737"}})])])])])])}),[],!1,null,null,null);e.default=s.exports}}]);