(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{526:function(s,a,e){"use strict";e.r(a);var v=e(27),_=Object(v.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"linux设置swap空间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#linux设置swap空间"}},[s._v("#")]),s._v(" Linux设置swap空间")]),s._v(" "),e("p",[s._v("服务器上日常运行着静态博客+云笔记+jenkins的容器，jenkins用于gitee上托管的博客repo的ci/cd。当jenkins进行构建时，内存占用率会急剧升高，轻则容器宕机，重则服务器跟着一起boom。因此需要设置swap来缓解jenkins内存占用瞬时升高的状况。")]),s._v(" "),e("h2",{attrs:{id:"查看磁盘分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看磁盘分区"}},[s._v("#")]),s._v(" 查看磁盘分区")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("df -h")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://storyxc.com/images/blog/image-20220310010316020.png",alt:"image-20220310010316020"}})]),s._v(" "),e("p",[s._v("Filesystem中"),e("code",[s._v("/dev/vda1")]),s._v("挂载点为"),e("code",[s._v("/")]),s._v("的就是我们的磁盘")]),s._v(" "),e("blockquote",[e("p",[s._v("一般来说swap大小设置规则：")]),s._v(" "),e("p",[s._v("4G以内RAM，Swap设置为2倍RAM")]),s._v(" "),e("p",[s._v("4G-8GRAM，Swap设置等于内存大小")]),s._v(" "),e("p",[s._v("8G-64G，Swap设置为8G")]),s._v(" "),e("p",[s._v("64G-256G，Swap设置为16G")])]),s._v(" "),e("h2",{attrs:{id:"创建swap分区文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建swap分区文件"}},[s._v("#")]),s._v(" 创建Swap分区文件")]),s._v(" "),e("p",[s._v("我这个是腾讯云4c 4G 80G的机器，这里swap设置为4G："),e("code",[s._v("fallocate -l 4G /swap")])]),s._v(" "),e("h2",{attrs:{id:"启用swap分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启用swap分区"}},[s._v("#")]),s._v(" 启用Swap分区")]),s._v(" "),e("p",[s._v("修改权限使文件只能root访问："),e("code",[s._v("chmod 600 /swap")])]),s._v(" "),e("p",[s._v("将文件标记为swap空间："),e("code",[s._v("mkswap /swap")])]),s._v(" "),e("p",[s._v("启用swap文件："),e("code",[s._v("swapon /swap")])]),s._v(" "),e("p",[s._v("验证交换是否可用："),e("code",[s._v("swapon --show")])]),s._v(" "),e("h2",{attrs:{id:"持久化swap挂载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#持久化swap挂载"}},[s._v("#")]),s._v(" 持久化swap挂载")]),s._v(" "),e("p",[s._v("备份fstab："),e("code",[s._v("cp /etc/fstab /etc/fstab.bak")])]),s._v(" "),e("p",[s._v("添加一条记录： "),e("code",[s._v("echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab")])]),s._v(" "),e("h2",{attrs:{id:"调整swap设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#调整swap设置"}},[s._v("#")]),s._v(" 调整Swap设置")]),s._v(" "),e("ul",[e("li",[s._v("swappiness")])]),s._v(" "),e("p",[s._v("调整Swappiness参数，该参数主要配置系统将数据从RAM交换到交换空间的频率。该参数的值是介于0和100之间的百分比。范围在0到100之间。 低参数值会让内核尽量少用交换，更高参数值会使内核更多的去使用交换空间。")]),s._v(" "),e("p",[s._v("查看当前swappiness值："),e("code",[s._v("cat /proc/sys/vm/swappiness")])]),s._v(" "),e("p",[s._v("临时修改，重启失效："),e("code",[s._v("sysctl vm.swappiness=10")])]),s._v(" "),e("p",[s._v("永久设置："),e("code",[s._v("vim /etc/sysctl.conf")]),s._v("，最后一行加上"),e("code",[s._v("vm.swappiness=10")]),s._v("，保存并退出。"),e("code",[s._v("sysctl -p")]),s._v("立即生效")]),s._v(" "),e("ul",[e("li",[s._v("vfs_cache_pressure\n表示强制Linux VM最低保留多少空闲内存（Kbytes）。当可用内存低于这个参数时，系统开始回收cache内存，以释放内存，直到可用内存大于这个值。\n查看 "),e("code",[s._v("cat /proc/sys/vm/vfs_cache_pressure")]),s._v("\n缺省值100表示内核将根据pagecache和swapcache，把directory和inode cache保持在一个合理的百分比；降低该值低于100，将导致内核倾向于保留directory和inode cache；增加该值超过100，将导致内核倾向于回收directory和inode cache。")])]),s._v(" "),e("p",[e("code",[s._v("vim /etc/sysctl.conf")]),s._v("，最后一行加上"),e("code",[s._v("vm.vfs_cache_pressure=50")])])])}),[],!1,null,null,null);a.default=_.exports}}]);