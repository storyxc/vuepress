(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{535:function(t,v,a){"use strict";a.r(v);var _=a(27),s=Object(_.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"iptables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[t._v("#")]),t._v(" iptables")]),t._v(" "),a("p",[t._v("iptables是一个用户级程序，用于操作内核级的网络模块"),a("code",[t._v("netfilter")])]),t._v(" "),a("h2",{attrs:{id:"表和链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表和链"}},[t._v("#")]),t._v(" 表和链")]),t._v(" "),a("p",[t._v("iptables的功能由表的形式呈现，每张表由若干个链组成，每个链可以分配一组规则")]),t._v(" "),a("p",[t._v("iptables有五张内建表，按照优先级高到底分别是：Raw、Mangle、NAT、Filter、Security")]),t._v(" "),a("h3",{attrs:{id:"raw"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raw"}},[t._v("#")]),t._v(" Raw")]),t._v(" "),a("p",[t._v("此表负责数据包标记，决定数据包是否被状态跟踪机制处理，Raw表有2个内建链")]),t._v(" "),a("ul",[a("li",[t._v("PREROUTING：用于通过任何网络接口到达的数据包")]),t._v(" "),a("li",[t._v("OUTPUT：针对本地进程产生的数据包")])]),t._v(" "),a("h3",{attrs:{id:"mangle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mangle"}},[t._v("#")]),t._v(" Mangle")]),t._v(" "),a("p",[t._v("此表负责更改数据包内容,Mangle表有5个内建链")]),t._v(" "),a("ul",[a("li",[t._v("PREROUTING")]),t._v(" "),a("li",[t._v("OUTPUT")]),t._v(" "),a("li",[t._v("FORWARD")]),t._v(" "),a("li",[t._v("INPUT")]),t._v(" "),a("li",[t._v("POSTROUTING")])]),t._v(" "),a("h3",{attrs:{id:"nat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nat"}},[t._v("#")]),t._v(" NAT")]),t._v(" "),a("p",[t._v("此表负责数据包的ip地址转换，NAT表有3种内建链")]),t._v(" "),a("ul",[a("li",[t._v("PREROUTING：处理刚到达本机并在路由转发前的数据包。它会转换数据包中的目标IP地址（destination ip address），通常用于DNAT(destination NAT)。")]),t._v(" "),a("li",[t._v("POSTROUTING：处理即将离开本机的数据包。它会转换数据包中的源IP地址（source ip address），通常用于SNAT（source NAT）。")]),t._v(" "),a("li",[t._v("OUTPUT：处理本机产生的数据包。")])]),t._v(" "),a("h3",{attrs:{id:"filter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filter"}},[t._v("#")]),t._v(" Filter")]),t._v(" "),a("p",[t._v("此表负责过滤数据包，iptables的默认表，具有3种内建链")]),t._v(" "),a("ul",[a("li",[t._v("INPUT：处理来自外部的数据。")]),t._v(" "),a("li",[t._v("OUTPUT：处理向外发送的数据。")]),t._v(" "),a("li",[t._v("FORWARD：将数据转发到本机的其他网卡设备上。")])]),t._v(" "),a("h3",{attrs:{id:"security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security"}},[t._v("#")]),t._v(" Security")]),t._v(" "),a("p",[t._v("新加入的特性，用于强制访问控制（MAC）网络规则，有3种内建链")]),t._v(" "),a("ul",[a("li",[t._v("INPUT")]),t._v(" "),a("li",[t._v("OUTPUT")]),t._v(" "),a("li",[t._v("FORWARD")])]),t._v(" "),a("h2",{attrs:{id:"iptables数据包处理流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables数据包处理流程图"}},[t._v("#")]),t._v(" iptables数据包处理流程图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://storyxc.com/images/blog/v2-6c9358844d8f440486551d925dfe36b5_1440w.jpg",alt:"v2-6c9358844d8f440486551d925dfe36b5_1440w"}})]),t._v(" "),a("h2",{attrs:{id:"iptables语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables语法"}},[t._v("#")]),t._v(" iptables语法")]),t._v(" "),a("h3",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[t._v("#")]),t._v(" 语法")]),t._v(" "),a("p",[a("code",[t._v("iptables [-t 表名] 命令选项 [链名] [匹配条件] [-j 策略]")])]),t._v(" "),a("p",[t._v("iptables命令包含五个部分")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("表名：要操作的表，不指定时默认操作Filter表")])]),t._v(" "),a("li",[a("p",[t._v("链名：要操作的链，不指定链时默认表内所有链")])]),t._v(" "),a("li",[a("p",[t._v("命令选项：要进行的操作")])]),t._v(" "),a("li",[a("p",[t._v("匹配条件：定义规则适用哪些数据包（匹配哪些数据包）")])]),t._v(" "),a("li",[a("p",[t._v("策略：匹配数据的目标执行的操作，说白了就是packet匹配上规则后该干嘛")])])]),t._v(" "),a("h3",{attrs:{id:"常见的命令选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的命令选项"}},[t._v("#")]),t._v(" 常见的命令选项")]),t._v(" "),a("ul",[a("li",[t._v("-A 在指定链的末尾添加（append）一条新的规则")]),t._v(" "),a("li",[t._v("-D 删除（delete）指定链中的某一条规则，可以按规则序号和内容删除")]),t._v(" "),a("li",[t._v("-I 在指定链中插入（insert）一条新的规则，默认在第一行添加")]),t._v(" "),a("li",[t._v("-R 修改、替换（replace）指定链中的某一条规则，可以按规则序号和内容替换")]),t._v(" "),a("li",[t._v("-L 列出（list）指定链中所有的规则进行查看")]),t._v(" "),a("li",[t._v("-E 重命名用户定义的链，不改变链本身")]),t._v(" "),a("li",[t._v("-F 清空（flush）")]),t._v(" "),a("li",[t._v("-N 新建（new-chain）一条用户自己定义的规则链")]),t._v(" "),a("li",[t._v("-X 删除指定表中用户自定义的规则链（delete-chain）")]),t._v(" "),a("li",[t._v("-P 设置指定链的默认策略（policy）")]),t._v(" "),a("li",[t._v("-Z 将所有表的所有链的字节和数据包计数器清零")]),t._v(" "),a("li",[t._v("-n 使用数字形式（numeric）显示输出结果")]),t._v(" "),a("li",[t._v("-v 查看规则表详细信息（verbose）的信息")]),t._v(" "),a("li",[t._v("-V 查看版本(version)")]),t._v(" "),a("li",[t._v("-h 获取帮助（help）")])]),t._v(" "),a("h3",{attrs:{id:"常见策略-target"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见策略-target"}},[t._v("#")]),t._v(" 常见策略（target）")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("ACCEPT：允许数据包通过。")])]),t._v(" "),a("li",[a("p",[t._v("DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应。")])]),t._v(" "),a("li",[a("p",[t._v("REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息。")])]),t._v(" "),a("li",[a("p",[t._v("SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题。")])]),t._v(" "),a("li",[a("p",[t._v("MASQUERADE：是SNAT的一种特殊形式，适用于动态的、临时会变的ip上。")])]),t._v(" "),a("li",[a("p",[t._v("DNAT：目标地址转换。")])]),t._v(" "),a("li",[a("p",[t._v("REDIRECT：在本机做端口映射。")])])]),t._v(" "),a("h3",{attrs:{id:"添加规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加规则"}},[t._v("#")]),t._v(" 添加规则")]),t._v(" "),a("ul",[a("li",[t._v("-A：在链的末尾追加一条规则，例如"),a("code",[t._v("iptables -A INPUT -s 127.0.0.1 -p tcp --dport 3306 -j ACCEPT")])]),t._v(" "),a("li",[t._v("-I：在链的开头（或指定序号）插入一条规则，例如"),a("code",[t._v("iptables -I INPUT -p tcp -j ACCEPT")]),t._v("或"),a("code",[t._v("iptables -I INPUT 2 -p tcp -j ACCEPT")])])]),t._v(" "),a("h3",{attrs:{id:"查看规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看规则"}},[t._v("#")]),t._v(" 查看规则")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("-L：列出所有规则")])]),t._v(" "),a("li",[a("p",[t._v("-n：以数字形式显示地址、端口等信息")])]),t._v(" "),a("li",[a("p",[t._v("-v：显示更详细规则信息")])]),t._v(" "),a("li",[a("p",[t._v("--line-numbers：显示规则序号")])])]),t._v(" "),a("h3",{attrs:{id:"删除规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除规则"}},[t._v("#")]),t._v(" 删除规则")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("删除nat表INPUT链的第三条规则："),a("code",[t._v("iptables -t nat -D INPUT 3")])])]),t._v(" "),a("li",[a("p",[t._v("清空nat表所有规则："),a("code",[t._v("iptables -t nat -F")])])])]),t._v(" "),a("h3",{attrs:{id:"给指定的链设置默认策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给指定的链设置默认策略"}},[t._v("#")]),t._v(" 给指定的链设置默认策略")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("iptables -t filter -P FORWARD DROP")])])]),t._v(" "),a("h3",{attrs:{id:"通用匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通用匹配"}},[t._v("#")]),t._v(" 通用匹配")]),t._v(" "),a("h4",{attrs:{id:"协议匹配-p-protocol"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议匹配-p-protocol"}},[t._v("#")]),t._v(" 协议匹配 -p（protocol）")]),t._v(" "),a("ul",[a("li",[t._v("指定规则的协议，如tcp, udp, icmp等，可以使用"),a("strong",[t._v("all")]),t._v("来指定所有协议。")]),t._v(" "),a("li",[t._v("如果不指定**-p"),a("strong",[t._v("参数，则默认是")]),t._v("all**值。这并不明智，请总是明确指定协议名称。")]),t._v(" "),a("li",[t._v("可以使用协议名(如tcp)，或者是协议值（比如6代表tcp）来指定协议。映射关系请查看/etc/protocols")]),t._v(" "),a("li",[t._v("还可以使用**–protocol"),a("strong",[t._v("参数代替")]),t._v("-p**参数")])]),t._v(" "),a("h4",{attrs:{id:"地址匹配-s-d"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#地址匹配-s-d"}},[t._v("#")]),t._v(" 地址匹配 -s -d：")]),t._v(" "),a("h5",{attrs:{id:"s-源地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#s-源地址"}},[t._v("#")]),t._v(" -s 源地址")]),t._v(" "),a("ul",[a("li",[t._v("指定数据包的源地址")]),t._v(" "),a("li",[t._v("参数可以使IP地址、网络地址、主机名")]),t._v(" "),a("li",[t._v("例如：-s 192.168.1.101指定IP地址")]),t._v(" "),a("li",[t._v("例如：-s 192.168.1.10/24指定网络地址")]),t._v(" "),a("li",[t._v("如果不指定-s参数，就代表所有地址")]),t._v(" "),a("li",[t._v("还可以使用**–src"),a("strong",[t._v("或者")]),t._v("–source**")])]),t._v(" "),a("h5",{attrs:{id:"d-目标地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#d-目标地址"}},[t._v("#")]),t._v(" -d 目标地址")]),t._v(" "),a("ul",[a("li",[t._v("指定目的地址")]),t._v(" "),a("li",[t._v("参数和**-s**相同")]),t._v(" "),a("li",[t._v("还可以使用**–dst"),a("strong",[t._v("或者")]),t._v("–destination**")])]),t._v(" "),a("h4",{attrs:{id:"接口匹配-i-o"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接口匹配-i-o"}},[t._v("#")]),t._v(" 接口匹配 -i -o")]),t._v(" "),a("h5",{attrs:{id:"i-输入接口-input-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-输入接口-input-interface"}},[t._v("#")]),t._v(" -i 输入接口（input interface）")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-i")]),t._v("代表输入接口(input interface)")]),t._v(" "),a("li",[a("strong",[t._v("-i")]),t._v("指定了要处理来自哪个接口的数据包")]),t._v(" "),a("li",[t._v("这些数据包即将进入INPUT, FORWARD, PREROUTE链")]),t._v(" "),a("li",[t._v("例如："),a("strong",[t._v("-i eth0")]),t._v("指定了要处理经由eth0进入的数据包")]),t._v(" "),a("li",[t._v("如果不指定**-i**参数，那么将处理进入所有接口的数据包")]),t._v(" "),a("li",[t._v("如果出现**!** -i eth0，那么将处理所有经由"),a("strong",[t._v("eth0以外的接口")]),t._v("进入的数据包")]),t._v(" "),a("li",[t._v("如果出现-i eth**+"),a("strong",[t._v("，那么将处理所有经由")]),t._v("eth开头的接口**进入的数据包")]),t._v(" "),a("li",[t._v("还可以使用**–in-interface**参数")])]),t._v(" "),a("h5",{attrs:{id:"o-输出-out-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#o-输出-out-interface"}},[t._v("#")]),t._v(" -o 输出（out interface）")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("-o")]),t._v("代表”output interface”")]),t._v(" "),a("li",[a("strong",[t._v("-o")]),t._v("指定了数据包由哪个接口输出")]),t._v(" "),a("li",[t._v("这些数据包即将进入FORWARD, OUTPUT, POSTROUTING链")]),t._v(" "),a("li",[t._v("如果不指定**-o**选项，那么系统上的所有接口都可以作为输出接口")]),t._v(" "),a("li",[t._v("如果出现**!** -o eth0，那么将从"),a("strong",[t._v("eth0以外的接口")]),t._v("输出")]),t._v(" "),a("li",[t._v("如果出现-i eth**+"),a("strong",[t._v("，那么将仅从")]),t._v("eth开头的接口**输出")]),t._v(" "),a("li",[t._v("还可以使用**–out-interface**参数")])]),t._v(" "),a("h3",{attrs:{id:"隐含匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐含匹配"}},[t._v("#")]),t._v(" 隐含匹配")]),t._v(" "),a("h4",{attrs:{id:"端口匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口匹配"}},[t._v("#")]),t._v(" 端口匹配")]),t._v(" "),a("h5",{attrs:{id:"sport-源端口-source-port-针对-p-tcp-或者-p-udp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sport-源端口-source-port-针对-p-tcp-或者-p-udp"}},[t._v("#")]),t._v(" -–sport 源端口（source port） 针对-p tcp 或者 -p udp")]),t._v(" "),a("ul",[a("li",[t._v("缺省情况下，将匹配所有端口")]),t._v(" "),a("li",[t._v("可以指定端口号或者端口名称，例如”–sport 22″与”–sport ssh”。")]),t._v(" "),a("li",[t._v("/etc/services文件描述了上述映射关系。")]),t._v(" "),a("li",[t._v("从性能上讲，使用端口号更好")]),t._v(" "),a("li",[t._v("使用冒号可以匹配端口范围，如”–sport 22:100″")]),t._v(" "),a("li",[t._v("还可以使用”–source-port”")])]),t._v(" "),a("h5",{attrs:{id:"dport-目的端口-destination-port-针对-p-tcp-或者-p-udp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dport-目的端口-destination-port-针对-p-tcp-或者-p-udp"}},[t._v("#")]),t._v(" –-dport 目的端口（destination port） 针对-p tcp 或者 -p udp")]),t._v(" "),a("ul",[a("li",[t._v("参数和–sport类似")]),t._v(" "),a("li",[t._v("还可以使用”–destination-port”")])]),t._v(" "),a("h5",{attrs:{id:"tcp-flags-tcp标志-针对-p-tcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp-flags-tcp标志-针对-p-tcp"}},[t._v("#")]),t._v(" -–tcp-flags TCP标志 针对-p tcp")]),t._v(" "),a("ul",[a("li",[t._v("可以指定由逗号分隔的多个参数")]),t._v(" "),a("li",[t._v("有效值可以是：SYN, ACK, FIN, RST, URG, PSH")]),t._v(" "),a("li",[t._v("可以使用"),a("strong",[t._v("ALL")]),t._v("或者"),a("strong",[t._v("NONE")])])]),t._v(" "),a("h5",{attrs:{id:"icmp-type-icmp类型-针对-p-icmp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#icmp-type-icmp类型-针对-p-icmp"}},[t._v("#")]),t._v(" -–icmp-type ICMP类型 针对-p icmp")]),t._v(" "),a("ul",[a("li",[t._v("–icmp-type 0 表示Echo Reply")]),t._v(" "),a("li",[t._v("–icmp-type 8 表示Echo")])]),t._v(" "),a("h3",{attrs:{id:"显式匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显式匹配"}},[t._v("#")]),t._v(" 显式匹配")]),t._v(" "),a("p",[t._v("多端口匹配 -m multiport --sport 源端口列表 -m multiport --dport 目的端口列表\nIP范围匹配 -m iprange --src-range IP范围\nMAC地址匹配 -m mac –mac1-source MAC地址\n状态匹配 -m state --state 连接状态")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("iptables -A INPUT -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25,80")]),t._v(",110,143 -j ACCEPT\niptables -A FORWARD -p tcp -m iprange --src-range "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".4.21-192.168.4.28 -j ACCEPT\niptables -A INPUT -m mac --mac-source 00:0c:29:c0:55:3f -j DROP\niptables -P INPUT DROP\niptables -I INPUT -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("-82,85 -j ACCEPT\niptables -I INPUT -p tcp -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])])}),[],!1,null,null,null);v.default=s.exports}}]);