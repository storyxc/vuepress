---
title: JavaScript
date: 2023-04-06 20:03:56
permalink: /pages/214c71/
categories:
  - 前端
  - 基础
tags:
  - js
  - JavaScript
---
# JavaScript

## 组成

- ECMAScript：规定了js基础语法，比如变量、分支语句、循环语句、对象等
- Web APIs
  - DOM：操作文档，比如对页面元素移动、添加删除等操作
  - BOM：操作浏览器，比如页面弹窗、检测窗口宽度、存储数据到浏览器等

## 基本语法

### 输入

`prompt()`

### 输出

`console.log()`

`document.write()`

`alert()`

> alert和prompt会跳过页面渲染先被执行

### 变量

#### 声明

- `let`

> 比较旧的JavaScript中使用var声明变量
>
> var的一些问题：
>
> - 可以先使用，再声明
> - var声明过的变量可以重复声明
> - 变量提升、全局变量、没有块级作用域

#### 命名

- 只能下划线、字母、数字、$，且不能数字开头
- 字母区分大小写

##### 规范

- 小驼峰

### 数组

- `let arr = [1, 2, 3]` / `let arr = new Array(1, 2, 3)`
- 数组有序
- 取值：数组[下标]
- 长度：数组.length
- 修改：arr[下标] = 新值
- 增加
  - arr.push() 将一个或多个元素新增到末尾，返回新的数组长度
  - arr.unshift()将一个或多个元素新增到开头，返回新的数组长度

- 删除
  - arr.pop() 删除最后一个元素，并返回该元素的值
  - arr.shift()删除第一个元素，并返回该元素的值
  - arr.splice(操作的下标，删除的个数)，删除指定元素并返回


### 常量

- 声明：`const`
- 声明常量必须赋值

### 数据类型

#### 基本数据类型

- number

- string

  - 模板字符串: 使用反引号包裹数据，使用${}替换数据

    ```js
    let age = 20
    console.log(`我今年${age}岁`)
    ```

- boolean

- undefined

  - 没有赋值
  - undefined +1 -> NaN

- null

  - 内容为空
  - null + 1 -> 1

##### NaN

NaN代表一个计算错误，是一个不正确或未定义的数学操作得到的结果，任何对NaN的操作都会返回NaN

#### typeof

- 运算符写法：typeof 变量
- 函数写法：typeof(变量)

#### 数据类型转换

##### 隐式转换

- `+`号两边只要有字符串，都会转字符串
- 除了`+`，其他算数运算符会把数据转换为数字类型
- `+`作为正号可以转换数字

##### 显式转换

- Number(变量)

#### 引用数据类型

- object

  ```js
  let obj = {
    uname: 'abc',
    age: 18,
    gender: '女',
    speak: function(x) {
      console.log('hello' + x)
    }
  }
  ```

  - 属性名可以用引号，一般省略，除非遇到特殊符号（空格、中横线等）

- 查看: 

  - 对象.属性
  - 对象['属性']

- 修改: 对象.属性 = 新值

- 新增: 对象.新属性 = 值

- 删除: delete 对象.属性

- 对象方法: 对象.方法名()

- 遍历对象

  - ```js
    for (let k in obj) {
      console.log(obj[k]) //k带引号
    }
    ```


> for in遍历数组 是数组下标，但是是字符串
>

### 运算符

#### 赋值运算符

- +=
- -=
- *=
- /=
- %=

#### 一元运算符

- `++`
- `--`

#### 比较运算符

- `<`
- `>`
- `>=`
- `<=`
- `==`: 值是否相等
- `===`：类型和值是否都相等
- `!==`：是否不全等

#### 逻辑运算符

- `&&`
- `||`
- `!`

### 流程控制语句

- if
  - 除了0，所有的数字都为真
  - 除了''，所有字符串都为真

- switch case

  - 数据和值必须满足全等`===`

  - ```js
    switch (数据) {
      case 值1:
        代码1
        break
      case 值2:
        代码2
        break
      default:
        代码n
    }
    ```

  - 

- 三元运算符

### 循环控制语句

- while
- for
- break/continue

### 函数

```js
function 函数名(参数列表) {
  函数体
}
```

- 命名 小驼峰

- return
  - 没有return 默认返回undefined

### 作用域

- 全局变量
  - 局部变量或块级变量 没有let声明直接赋值的当全局变量看（不提倡）
- 局部变量



### 匿名函数

- 函数表达式：把匿名函数赋值给一个变量，通过变量名调用

  - ```js
    let fn = function () {}
    ```

- 立即执行函数

  - ```js
    (function() {...})();
    (function() {...})();
    ---
    (function(x, y) {
      console.log(x + y)
    })(1, 3)
    ```

  - 前一个括号声明，后一个括号调用

  - 分号

### 逻辑中断

- 短路：只存在`&&`和`||`中，当满足一定条件会让右边代码不执行
  - `&&`：左边为false就短路
  - `||`：左边为true就短路

### 转换boolean

- "": false
- 0: false
- undefined: false
- null: false
- NaN: false

- "" + 1 = 1
- null经过数字转换会变0
- undefined经过数字转换会变NaN

## Web APIs

### DOM

#### 获取DOM元素

- document.querySelector(CSS选择器)：获取匹配的第一个元素
- document.querySelectorAll(CSS选择器)：获取匹配的多个元素

#### 操作元素内容

- 对象.innerText

- 对象.innerHTML

- 对象.属性=值

  - ```js
    const image = document.querySelector('img')
    image.src = 'xxx.jpg'
    image.title = '123'
    ```

- 对象.style.样式属性=值

  - ```js
    box.style.width = '300px'
    box.backgroundColor = 'pink' //小驼峰
    ```

- 通过类名修改属性，会覆盖

  - ```js
    //定义好类对应的属性，给对象添加类名
    对象.className = 类名
    ```

- 通过classList操作类控制CSS，用于追加和删除

  - ```js
    元素.classList.add(类名)//追加
    元素.classList.remove(类名)//删除
    元素.classList.toggle(类名)//切换
    ```

- 自定义属性

  - H5中推出的data-自定义属性

  - 在标签上一律以`data-`开头

  - DOM对象上一律以`dataset`对象方式获取

  - ```html
    <body>
      <div class="box" data-id="10">盒子</div>
      <script>
        const box = document.querySelector('.box')
        console.log(box.dataset.id)
      </script>
    </body>
    ```

#### 事件监听

- 元素对象.addEventListener('事件类型', 要执行的函数)

> 元素.on事件：也可以添加事件监听，但会被覆盖，且只能冒泡 不能捕获，addEventListener不会被覆盖，能冒泡 也能捕获。

- 事件类型
  - 鼠标事件
    - click
    - mouseenter
    - mouseleave
  - 焦点事件
    - focus
    - blur
  - 键盘事件
    - keydown
    - keyup
  - 文本事件
    - input

#### 事件对象

事件对象中有事件触发时的相关信息，例如鼠标点击时的位置，键盘按下时的键位

```js
btn.addEventListener('click', function(e){
  console.log(e)
})
```

##### 常用对象属性

- type：事件类型
- clientX/clientY:光标相对于浏览器可见窗口左上角的位置
- offsetX/offsetY：光标相对于当前DOM元素左上角的位置
- key：用户按下的键盘的值，现在不提倡使用keyCode



#### 环境对象

指的是函数内部特殊的变量`this`，它代表着当前函数运行时所处的环境

- 函数的调用方式不同，`this`的指代对象也不通
- `this`指向的粗略规则是谁调用指向谁（addEventListener指向绑定的元素，普通函数指向window）



#### 回调函数

函数A作为参数传递给函数B，A就被称为回调函数

#### 事件流

事件流指的是事件完整执行过程中的流动路径

##### 事件捕获

DOM的根元素开始去执行对应的事件（从父元素到子元素）

```js
DOM.addEventListener(事件类型, 函数, 是否使用捕获机制)
```

> L0事件只有冒泡，没有捕获

##### 事件冒泡

当一个元素的事件被触发时，同样的事件会在该元素的所有祖先元素中依次被触发。这一过程被称为事件冒泡（从子元素到父元素）

- 简单理解：当一个元素触发事件后，会依次向上调用所有父级元素的**同名事件**

- 事件冒泡是默认存在的

##### 阻止事件传播

- 事件对象.stopPropagation()
- 阻断事件流动传播，既能阻止冒泡，也能阻止捕获

```js
btn.addEventListener('click', function(e){
  e.stopPropagation()
})
```

##### 解绑事件

- on事件方式

  - ```js
    // 绑定事件
    btn.onClick = function(e){
      console.log(e)
    }
    // 解绑事件
    btn.onClick = null
    ```

- addEventListener方式

  - ```js
    function fn(e){
      console.log(e)
    }
    //绑定事件
    btn.addEventListener('click', fn)
    //解绑事件
    btn.removeEventListener('click', fn)
    ```

  - 匿名函数无法解绑

##### 事件委托

事件委托是利用事件流特征解决开发问题的技巧，可以减少事件注册次数，提高程序性能，原理是利用事件冒泡特点，给父元素注册事件，当触发子元素的时候，会冒泡到父元素身上，从而触发父元素的事件



##### 阻止元素默认行为

`e.preventDefault()`

##### 其他事件

- 页面加载事件

  - 外部资源加载完毕时触发的事件

    - 等待页面所有资源加载完毕，执行回调函数：`window.addEventListener('load', function() {})`

      > 也可以针对某个资源绑定事件：img.addEventListener('load', function() {}) 

  - 初始HTML文档被完全加载和解析完成后，DOMContentLoaded事件被触发，无需等待样式表、图像等完全加载

    - `document.addEventListener('DOMContentLoaded', function() {})`

- 页面滚动事件

  - 滚动条在滚动的时候持续触发的事件

    - `window.addEventListener('scroll', function() {})`
    - 给window或document添加scroll事件
    - 也可以监听某个元素内部滚动

  - 获取滚动位置

    - scrollLeft**（可读写）**

    - scrollTop**（可读写）**

    - ```js
      window.addEventListener('scroll', function() {
        const n = document.documentElement.scrollTop
        console.log(n)
      })
      ```

      > document.documentElement返回对象为HTML元素
      >
      > <html lang="en">
      >
      > <head>...</head>
      >
      > <body>...</body>
      >
      > </html>

  - 滚动到指定坐标
    - scrollTo(x, y)

- 页面尺寸事件

  - 窗口尺寸改变时触发的事件`resize`
    - `window.addEventListener('resize', function() {})`
  - 获取元素可见部分的宽高`clientWidth`、`clientHeight`
    - 不包含border，margin，滚动条

#### 元素尺寸位置

##### 获取宽高

- offsetWidth和offsetHeight
- 获取元素自身的宽高，包含padding，border
- 结果是数值
- 获取的是可视宽高，如果盒子隐藏，结果是0

##### 获取位置

- offsetLeft和offsetTop
- 获取元素距离自己**定位**父级元素的左、上距离，**只读属性**

##### 获取元素大小及其相对视口的位置

- `element.getBoundingClientRect()`

#### 日期对象

- 实例化
  - `const date = new Date()`
  - `const date = new Date('2023-4-8 08:00:00')`

- 常用方法
  - getFullYear():四位数年份
  - getMonth():月份，范围0-11
  - getDate():获取月份中的每一天
  - getDay():获取星期，0-6
  - getHours():小时，0-23
  - getMinutes():分钟，0-59
  - getSeconds():秒，0-59
  - toLocaleString(): yyyy/m/d HH:mm:ss
- 时间戳
  - `date.getTime()`
  - `+new Date()`
  - `Date.now()`

#### DOM节点

##### 节点类型

- 元素节点
- 属性节点
- 文本节点
- 其他（注释、文档类型、CDATA、实体引用、处理指令。。。）

##### 查找节点

- 父节点
  - 元素.parentNode
- 子节点
  - 元素.childNodes：获取所有子节点，包括文本（空格、换行）、注释节点等
  - 元素.children：仅获取元素节点，返回的是一个伪数组
- 兄弟节点
  - nextElementSibling：下一个兄弟节点
  - previousElementSibling:上一个兄弟节点

##### 新增节点

###### 创建节点

- `const div = document.createElement('div')`

###### 追加节点

- `父元素.appendChild(div)`

- `父元素.insertBefore(要插入的元素, 在哪个元素前面)`：插入某个元素之前
  - 例：`ul.insertBefore(li, ul.children[0])`

###### 克隆节点

- 元素.cloneNode(布尔值)
  - true：克隆时会包含后代节点一起克隆
  - false：不包含后代节点，默认值

##### 删除节点

- `父元素.removeChild(子元素)`



### BOM

#### 组成

BOM（Browser Object Model）是浏览器对象模型，包含：navigator、location、document、history、screen

window是一个全局对象，document、alert()、console.log()都是window的属性

- 所有通过`var`定义在全局作用域中的变量、函数都会变成window对象的属性和方法
- window对象下的属性和方法调用的时候可以省略window

#### 定时器

##### 延时函数

- `let timer = setTimeout(回调函数, 等待时间ms)`，返回id，setTimeout只执行一次
- 关闭：`clearTimeout(timer)`

##### 间歇函数

- `let interval = setInterval(函数, 间隔时间ms)`，返回的是的是一个id数字，不断执行
- 关闭：`clearInterval(interval)`

#### 事件循环

js是单线程，所有任务需要排队。HTML5提出了Web Worker标准，允许JavaScript脚本创建多个线程。于是JS出现了同步和异步。

- 同步任务：都在主线程执行，形成执行栈
- 异步任务：通过回调函数实现，异步任务添加到任务队列中，一般异步任务有以下三种类型
  - 普通事件：click、resize等
  - 资源加载：load、error等
  - 定时器：setTimeout、setInterval等

##### 执行机制

1. 先执行执行栈中的同步任务
2. 异步任务放到任务队列中
3. 执行栈中的所有同步任务执行完毕，系统会按次序读取任务队列中的异步任务，被读取的异步任务结束等待状态，进入执行栈，开始执行

#### location

localtion的数据类型是对象，它拆分保存了URL地址的各个组成部分

- `location.href`：常用于页面跳转

- `location.search`:获取地址中携带的参数，符号`?`后面的部分
- `location.hash`:获取地址中的hash值，符号`#`后面的部分
- `location.reload()`：用来刷新当前页面，传入参数true时强制刷新

#### navigator

navigator的数据类型是对象，该对象下记录了浏览器自身的相关信息

- navigator.userAgent:检测浏览器版本和平台

#### history

history数据类型是对象，主要管理历史记录，该对象与浏览器地址栏的操作相对应，如前进、后退、历史记录等

- history.back()
- history.forward()
- history.go(参数): 1->前进一个页面，-1->后退一个页面

#### 本地存储

##### 介绍

数据存储在用户浏览器中，设置、读取方便，刷新页面不会丢失数据，sessionStorage和localStorage约5M

##### 分类

- localStorage
  - 可以多窗口（页面）共享（同一浏览器可以共享）
  - 键值对形式存储使用
  - 语法
    - 存储：`localStorage.setItem(key, value)`
    - 查询：`localStorage.getItem(key)`
    - 删除：`localStorage.removeItem(key)`
- sessionStorage
  - 生命周期到关闭浏览器窗口截止
  - 在同一个窗口（页面）下数据可以共享
  - 键值对形式存储使用
  - 用法api和`localStorage`一致

##### 存储复杂数据类型

把复杂数据类型转成字符串形式存储

- `JSON.stringify`
- `JSON.parse`

#### 数组map和join

##### map

- 遍历数组处理数据，返回新的数组

- ```js
  const arr = ['red', 'blue']
  const newArr = arr.map(function(ele, index) {
    return ele + '颜色'
  })
  console.log(newArr) // ['red颜色', 'blue颜色']
  ```

##### join

- 把数组所有元素转换为一个字符串
- `const newStr = join(字符串)`:元素用指定字符串相连

## 其他

### 正则表达式

- 定义：`const reg = /表达式/`
- 判断是否匹配：`reg.test(被检测字符串)`，匹配返回true，否则false
- 查找：`reg.exec(被检测字符串)`，找到返回数组，否则为null

#### 元字符

- 边界符
  - `^`：开始
  - `$`：结束
- 量词
  - `*`：0或多次
  - `+`：1或多次
  - `?`：0或1次
  - `{n}`：重复n次
  - `{n,}`：重复n次或更多
  - `{n,m}`：重复n次到m次
- 字符类
  
  - `[]`：匹配字符集合，匹配任一个都是true
  - `[a-zA-Z]`：字母
  - `[^a-z]`：[]中的^表示取反
  - `.`：除换行之外的任何单个字符
  - `\d`：数字
  - `\D`：所有0-9以外字符，等于`[^0-9]`
  - `\w`：任一字母、数字、下划线，相当于`[a-zA-Z0-9_]`
  - `\W`：匹配除字母、数字、下划线之外的字符，相当于`[^a-zA-Z0-9_]`
  - `\s`：匹配空格（包括制表符、换行符、空格符等）,相当于`[\t\r\n\v\f]`
  - `\S`：匹配非空格，相当于`[^\t\r\n\v\f]`

#### 修饰符

- 语法：`/表达式/修饰符`

- 修饰符：
  - i：ignore，匹配时，不区分大小写
  - g：global，匹配所有满足正则的结果

#### 替换

- 语法：`字符串.replace(/正则表达式/， 替换的文本)`，返回替换后的字符串
