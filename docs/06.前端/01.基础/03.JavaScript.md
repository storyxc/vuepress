---
title: JavaScript
date: 2023-04-06 20:03:56
permalink: /pages/214c71/
categories:
  - 前端
  - 基础
tags:
  - js
  - JavaScript
---
# JavaScript

## 组成

- ECMAScript：规定了js基础语法，比如变量、分支语句、循环语句、对象等
- Web APIs
  - DOM：操作文档，比如对页面元素移动、添加删除等操作
  - BOM：操作浏览器，比如页面弹窗、检测窗口宽度、存储数据到浏览器等

## 基本语法

### 输入

`prompt()`

### 输出

`console.log()`

`document.write()`

`alert()`

> alert和prompt会跳过页面渲染先被执行

### 变量

#### 声明

- `let`

> 比较旧的JavaScript中使用var声明变量
>
> var的一些问题：
>
> - 可以先使用，再声明
> - var声明过的变量可以重复声明
> - 变量提升、全局变量、没有块级作用域

#### 命名

- 只能下划线、字母、数字、$，且不能数字开头
- 字母区分大小写

##### 规范

- 小驼峰

### 数组

- `let arr = [1, 2, 3]` / `let arr = new Array(1, 2, 3)`
- 数组有序
- 取值：数组[下标]
- 长度：数组.length
- 修改：arr[下标] = 新值
- 增加
  - arr.push() 将一个或多个元素新增到末尾，返回新的数组长度
  - arr.unshift()将一个或多个元素新增到开头，返回新的数组长度

- 删除
  - arr.pop() 删除最后一个元素，并返回该元素的值
  - arr.shift()删除第一个元素，并返回该元素的值
  - arr.splice(操作的下标，删除的个数)，删除指定元素并返回


### 常量

- 声明：`const`
- 声明常量必须赋值

### 数据类型

#### 基本数据类型

- number

- string

  - 模板字符串: 使用反引号包裹数据，使用${}替换数据

    ```js
    let age = 20
    console.log(`我今年${age}岁`)
    ```

- boolean

- undefined

  - 没有赋值
  - undefined +1 -> NaN

- null

  - 内容为空
  - null + 1 -> 1

##### NaN

NaN代表一个计算错误，是一个不正确或未定义的数学操作得到的结果，任何对NaN的操作都会返回NaN

#### typeof

- 运算符写法：typeof 变量
- 函数写法：typeof(变量)

#### 数据类型转换

##### 隐式转换

- `+`号两边只要有字符串，都会转字符串
- 除了`+`，其他算数运算符会把数据转换为数字类型
- `+`作为正号可以转换数字

##### 显式转换

- Number(变量)

#### 引用数据类型

- object

  ```js
  let obj = {
    uname: 'abc',
    age: 18,
    gender: '女',
    speak: function(x) {
      console.log('hello' + x)
    }
  }
  ```

  - 属性名可以用引号，一般省略，除非遇到特殊符号（空格、中横线等）

- 查看: 

  - 对象.属性
  - 对象['属性']

- 修改: 对象.属性 = 新值

- 新增: 对象.新属性 = 值

- 删除: delete 对象.属性

- 对象方法: 对象.方法名()

- 遍历对象

  - ```js
    for (let k in obj) {
      console.log(obj[k]) //k带引号
    }
    ```


> for in遍历数组 是数组下标，但是是字符串
>

### 运算符

#### 赋值运算符

- +=
- -=
- *=
- /=
- %=

#### 一元运算符

- `++`
- `--`

#### 比较运算符

- `<`
- `>`
- `>=`
- `<=`
- `==`: 值是否相等
- `===`：类型和值是否都相等
- `!==`：是否不全等

#### 逻辑运算符

- `&&`
- `||`
- `!`

### 流程控制语句

- if
  - 除了0，所有的数字都为真
  - 除了''，所有字符串都为真

- switch case

  - 数据和值必须满足全等`===`

  - ```js
    switch (数据) {
      case 值1:
        代码1
        break
      case 值2:
        代码2
        break
      default:
        代码n
    }
    ```

  - 

- 三元运算符

### 循环控制语句

- while
- for
- break/continue

### 函数

```js
function 函数名(参数列表) {
  函数体
}
```

- 命名 小驼峰

- return
  - 没有return 默认返回undefined

### 作用域

- 全局变量
  - 局部变量或块级变量 没有let声明直接赋值的当全局变量看（不提倡）
- 局部变量



### 匿名函数

- 函数表达式：把匿名函数赋值给一个变量，通过变量名调用

  - ```js
    let fn = function () {}
    ```

- 立即执行函数

  - ```js
    (function() {...})();
    (function() {...})();
    ---
    (function(x, y) {
      console.log(x + y)
    })(1, 3)
    ```

  - 前一个括号声明，后一个括号调用

  - 分号

### 逻辑中断

- 短路：只存在`&&`和`||`中，当满足一定条件会让右边代码不执行
  - `&&`：左边为false就短路
  - `||`：左边为true就短路

### 转换boolean

- "": false
- 0: false
- undefined: false
- null: false
- NaN: false

- "" + 1 = 1
- null经过数字转换会变0
- undefined经过数字转换会变NaN

## Web APIs

### DOM

#### 获取DOM元素

- document.querySelector(CSS选择器)：获取匹配的第一个元素
- document.querySelectorAll(CSS选择器)：获取匹配的多个元素

#### 操作元素内容

- 对象.innerText

- 对象.innerHTML

- 对象.属性=值

  - ```js
    const image = document.querySelector('img')
    image.src = 'xxx.jpg'
    image.title = '123'
    ```

- 对象.style.样式属性=值

  - ```js
    box.style.width = '300px'
    box.backgroundColor = 'pink' //小驼峰
    ```

- 通过类名修改属性，会覆盖

  - ```js
    //定义好类对应的属性，给对象添加类名
    对象.className = 类名
    ```

- 通过classList操作类控制CSS，用于追加和删除

  - ```js
    元素.classList.add(类名)//追加
    元素.classList.remove(类名)//删除
    元素.classList.toggle(类名)//切换
    ```

- 自定义属性

  - H5中推出的data-自定义属性

  - 在标签上一律以`data-`开头

  - DOM对象上一律以`dataset`对象方式获取

  - ```html
    <body>
      <div class="box" data-id="10">盒子</div>
      <script>
        const box = document.querySelector('.box')
        console.log(box.dataset.id)
      </script>
    </body>
    ```

- 定时器-间歇函数

  - setInterval(函数, 间隔时间ms)，返回的是的是一个id数字
  - clearInterval(id参数)，关闭定时器

#### 事件监听

- 元素对象.addEventListener('事件类型', 要执行的函数)

> 元素.on事件：也可以添加事件监听，但会被覆盖，且只能冒泡 不能捕获，addEventListener不会被覆盖，能冒泡 也能捕获。

- 事件类型
  - 鼠标事件
    - click
    - mouseenter
    - mouseleave
  - 焦点事件
    - focus
    - blur
  - 键盘事件
    - keydown
    - keyup
  - 文本事件
    - input

#### 事件对象

事件对象中有事件触发时的相关信息，例如鼠标点击时的位置，键盘按下时的键位

```js
btn.addEventListener('click', function(e){
  console.log(e)
})
```

##### 常用对象属性

- type：事件类型
- clientX/clientY:光标相对于浏览器可见窗口左上角的位置
- offsetX/offsetY：光标相对于当前DOM元素左上角的位置
- key：用户按下的键盘的值，现在不提倡使用keyCode



#### 环境对象

指的是函数内部特殊的变量`this`，它代表着当前函数运行时所处的环境

- 函数的调用方式不同，`this`的指代对象也不通
- `this`指向的粗略规则是谁调用指向谁（addEventListener指向绑定的元素，普通函数指向window）



#### 回调函数

函数A作为参数传递给函数B，A就被称为回调函数

#### 事件流

事件流指的是事件完整执行过程中的流动路径

##### 事件捕获

DOM的根元素开始去执行对应的事件（从父元素到子元素）

```js
DOM.addEventListener(事件类型, 函数, 是否使用捕获机制)
```

> L0事件只有冒泡，没有捕获

##### 事件冒泡

当一个元素的事件被触发时，同样的事件会在该元素的所有祖先元素中依次被触发。这一过程被称为事件冒泡（从子元素到父元素）

- 简单理解：当一个元素触发事件后，会依次向上调用所有父级元素的**同名事件**

- 事件冒泡是默认存在的

##### 阻止事件传播

- 事件对象.stopPropagation()
- 阻断事件流动传播，既能阻止冒泡，也能阻止捕获

```js
btn.addEventListener('click', function(e){
  e.stopPropagation()
})
```

##### 解绑事件

- on事件方式

  - ```js
    // 绑定事件
    btn.onClick = function(e){
      console.log(e)
    }
    // 解绑事件
    btn.onClick = null
    ```

- addEventListener方式

  - ```js
    function fn(e){
      console.log(e)
    }
    //绑定事件
    btn.addEventListener('click', fn)
    //解绑事件
    btn.removeEventListener('click', fn)
    ```

  - 匿名函数无法解绑

##### 事件委托

事件委托是利用事件流特征解决开发问题的技巧，可以减少事件注册次数，提高程序性能，原理是利用事件冒泡特点，给父元素注册事件，当触发子元素的时候，会冒泡到父元素身上，从而触发父元素的事件



##### 阻止元素默认行为

`e.preventDefault()`

##### 其他事件

- 页面加载事件

  - 外部资源加载完毕时触发的事件

    - 等待页面所有资源加载完毕，执行回调函数：`window.addEventListener('load', function() {})`

      > 也可以针对某个资源绑定事件：img.addEventListener('load', function() {}) 

  - 初始HTML文档被完全加载和解析完成后，DOMContentLoaded事件被触发，无需等待样式表、图像等完全加载

    - `document.addEventListener('DOMContentLoaded', function() {})`

- 页面滚动事件

  - 滚动条在滚动的时候持续触发的事件

    - `window.addEventListener('scroll', function() {})`
    - 给window或document添加scroll事件
    - 也可以监听某个元素内部滚动

  - 获取滚动位置

    - scrollLeft**（可读写）**

    - scrollTop**（可读写）**

    - ```js
      window.addEventListener('scroll', function() {
        const n = document.documentElement.scrollTop
        console.log(n)
      })
      ```

      > document.documentElement返回对象为HTML元素
      >
      > <html lang="en">
      >
      > <head>...</head>
      >
      > <body>...</body>
      >
      > </html>

  - 滚动到指定坐标
    - scrollTo(x, y)

- 页面尺寸事件

  - 窗口尺寸改变时触发的事件`resize`
    - `window.addEventListener('resize', function() {})`
  - 获取元素可见部分的宽高`clientWidth`、`clientHeight`
    - 不包含border，margin，滚动条

#### 元素尺寸位置

##### 获取宽高

- offsetWidth和offsetHeight
- 获取元素自身的宽高，包含padding，border
- 结果是数值
- 获取的是可视宽高，如果盒子隐藏，结果是0

##### 获取位置

- offsetLeft和offsetTop
- 获取元素距离自己**定位**父级元素的左、上距离，**只读属性**

##### 获取元素大小及其相对视口的位置

- `element.getBoundingClientRect()`
